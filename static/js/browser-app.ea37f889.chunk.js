"use strict";(self.webpackChunkgdevelop_ide=self.webpackChunkgdevelop_ide||[]).push([[7237],{41953:function(e,n,t){t.r(n),t.d(n,{create:function(){return Dt}});var r=t(1413),o=t(28381),i=t(90063),a=t(2066),s=t(36043),u=(t(94492),t(13778),t(93433)),c=t(74165),l=t(15861),d=t(29439),p=t(36600),f=t(17037),h=t(7660),g=t(70983),m=t.n(g),x=t(40243),v=t(61325),w=t(60022),b=t(42986),j=t(68009),y=t(14446),F=t.n(y),k=t(38092),S=t(15684),E=t(84140),P=t(1773),Z=t(52716),N=t(29343),R=function(e){var n=e.options,t=e.selectedResourceIndex,r=e.onSelectResource;if(!r)return null;var o=n.resourceKind;return f.xz.includes(o)?(0,N.jsx)(h.L,{selectedResourceIndex:t,onSelectResource:r,resourceKind:o}):null},C=function(e){var n=e.options,t=e.onChooseResources,r=e.createNewResource,i=o.useState(""),a=(0,d.Z)(i,2),s=a[0],u=a[1],f=o.useState(null),h=(0,d.Z)(f,2),g=h[0],y=h[1],S=o.useState([]),E=(0,d.Z)(S,2),P=E[0],Z=E[1],R=!!P.filter(Boolean).length,C=(0,j.N)(function(){var e=(0,l.Z)((0,c.Z)().mark((function e(t){var r,o;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.multiSelection?t.split("\n").filter(Boolean):[t],y(null),Z([]),e.prev=3,e.next=6,Promise.all(r.map(function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F().get(n,{timeout:1e3,validateStatus:function(e){return!0}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 6:o=e.sent,Z(o.map((function(e){return!(e.status>=200&&e.status<400)}))),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),y(e.t0);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(n){return e.apply(this,arguments)}}(),500);return o.useEffect((function(){C(s)}),[s,C]),(0,N.jsxs)(v.ak,{noMargin:!0,expand:!0,children:[(0,N.jsx)(x.x1,{noMargin:!0,children:(0,N.jsx)(v.ad,{renderButton:function(e){return(0,N.jsx)(w.Z,{onClick:function(){if(t&&r){var e=n.multiSelection?s.split("\n").filter(Boolean):[s];t(e.map((function(e){var n=r();return n.setFile(e),n.setName(m().basename(e)),n.setOrigin("url",e),n})))}},primary:!0,label:(0,N.jsx)(p.Trans,{id:"Choose"}),style:e,disabled:!!g||R})},renderTextField:function(){return(0,N.jsx)(b.Z,{floatingLabelText:n.multiSelection?(0,N.jsx)(p.Trans,{id:"Resource(s) URL(s) (one per line)"}):(0,N.jsx)(p.Trans,{id:"Resource URL"}),value:s,onChange:u,multiline:n.multiSelection,rows:1,rowsMax:5,fullWidth:!0,errorText:g?(0,N.jsx)(p.Trans,{id:"There was an error verifying the URL(s). Please check they are correct."}):R?(0,N.jsx)(p.Trans,{id:"Unable to verify URLs {0} . Please check they are correct.",values:{0:P.map((function(e,n){return e?"#"+(n+1):null})).filter(Boolean).join(", ")}}):null})}})}),(0,N.jsx)(k.Z,{kind:"warning",children:(0,N.jsx)(p.Trans,{id:"The URLs must be public and stay accessible while you work on this project - they won't be stored inside the project file. When exporting a game, the resources pointed by these URLs will be downloaded and stored inside the game."})})]})},D=[].concat((0,u.Z)(f.QP.map((function(e){var n=e.kind,t=e.createNewResource,r="upload-".concat(n);return{name:r,displayName:{id:"File(s) from your device"},displayTab:"import",shouldCreateResource:!0,shouldGuessAnimationsFromName:!0,kind:n,renderComponent:function(e){return(0,N.jsx)(S.V,{createNewResource:t,onChooseResources:function(n){return e.onChooseResources({selectedResources:n,selectedSourceName:r})},options:e.options,fileMetadata:e.fileMetadata,getStorageProvider:e.getStorageProvider,automaticallyOpenInput:!!e.automaticallyOpenIfPossible},"url-chooser-".concat(n))}}}))),(0,u.Z)(f.xz.map((function(e){var n=f.QP.find((function(n){return n.kind===e}));if(!n)return null;var t="resource-store-".concat(e);return{name:t,displayName:{id:"Choose from asset store"},displayTab:"standalone",shouldCreateResource:!0,shouldGuessAnimationsFromName:!1,kind:e,renderComponent:function(n){return(0,N.jsx)(R,{selectedResourceIndex:n.selectedResourceIndex,onSelectResource:n.onSelectResource,options:n.options},"resource-store-".concat(e))},renderPrimaryAction:function(r){var o=r.resource,i=r.onChooseResources;return(0,N.jsx)(P.v,{primary:!0,label:"font"===e?(0,N.jsx)(p.Trans,{id:"Install font"}):(0,N.jsx)(p.Trans,{id:"Add to project"}),disabled:!o,onClick:function(){if(o){var e=o.url,r=n.createNewResource();r.setFile(e);var a=(0,E.d0)(e)?(0,E.Lj)(e):m().basename(e);r.setName(a),r.setOrigin("gdevelop-asset-store",e),i({selectedResources:[r],selectedSourceName:t})}}},"add-resource")}}})).filter(Boolean)),(0,u.Z)(f.QP.map((function(e){var n=e.kind,t=(e.createNewResource,"project-resources-".concat(n));return{name:t,displayName:{id:"Project resources"},displayTab:"standalone",shouldCreateResource:!1,shouldGuessAnimationsFromName:!1,hideInResourceEditor:!0,kind:n,renderComponent:function(e){return(0,N.jsx)(Z.Z,{project:e.project,onResourcesSelected:e.onResourcesSelected,resourceKind:n,multiSelection:e.options.multiSelection},"project-resources-".concat(n))},renderPrimaryAction:function(e){var n=e.selectedResources,r=e.onChooseResources;return(0,N.jsx)(P.v,{primary:!0,label:n&&n.length&&1!==n.length?(0,N.jsx)(p.Trans,{id:"Select {0} resources",values:{0:n.length}}):(0,N.jsx)(p.Trans,{id:"Select resource"}),disabled:!n||!n.length,onClick:function(){n&&n.length&&r({selectedResources:n,selectedSourceName:t})}},"select-resources")}}}))),(0,u.Z)(f.QP.map((function(e){var n=e.kind,t=e.createNewResource,r="url-chooser-".concat(n);return{name:r,displayName:{id:"Use a public URL"},displayTab:"import-advanced",shouldCreateResource:!0,shouldGuessAnimationsFromName:!1,kind:n,renderComponent:function(e){return(0,N.jsx)(C,{createNewResource:t,onChooseResources:function(n){return e.onChooseResources({selectedResources:n,selectedSourceName:r})},options:e.options},"url-chooser-".concat(n))}}})))),I=t(4942),A=t(32705),T=t(62800),M=t(57974),O=t(81303),U=t(30141),L=function(e){e.document.write('<html>\n  <head>\n    <style>\n      body {\n        margin: 0;\n        padding: 0;\n        background-color: #000000;\n        overflow: hidden;\n        height: 100vh;\n        width: 100%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n      }\n      @keyframes spin {\n        100% {\n          transform:rotate(360deg);\n        }\n      }\n      .spinning-loader {\n        animation: spin 3s linear infinite;\n      }\n    </style>\n  </head>\n  <body>\n      <img class="spinning-loader" width="50" alt="Loading..." src="'.concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CjxjaXJjbGUgb3BhY2l0eT0nMC4yNScgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIiBzdHJva2U9IiNGRkZGRkYiIHN0cm9rZS13aWR0aD0iNCI+PC9jaXJjbGU+CjxwYXRoIG9wYWNpdHk9JzAuNzUnIGZpbGw9IiNGRkZGRkYiIGQ9Ik00IDEyYTggOCAwIDAxOC04VjBDNS4zNzMgMCAwIDUuMzczIDAgMTJoNHptMiA1LjI5MUE3Ljk2MiA3Ljk2MiAwIDAxNCAxMkgwYzAgMy4wNDIgMS4xMzUgNS44MjQgMyA3LjkzOGwzLTIuNjQ3eiI+PC9wYXRoPgo8L3N2Zz4=",'">\n  </body>\n</html>'))},G=t(23236),B=0,_={piskel:"external/piskel/piskel-index.html",yarn:"external/yarn/yarn-index.html",jfxr:"external/jfxr/jfxr-index.html"},z=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t,r,o,i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.externalEditorWindow,r=n.externalEditorName,o=n.externalEditorInput,!(i=n.signal).aborted){e.next=3;break}return e.abrupt("return",Promise.reject(new G.s("")));case 3:return e.abrupt("return",new Promise((function(e,n){var a=!1,s=!1,u=null,c=function(e){if(e.source===t)if(e.data&&"object"===typeof e.data){var n=e.data,i=n.id,s=n.payload;"external-editor-ready"===i?(console.info('External editor "'.concat(r,'" ready.')),a=!0,t.addEventListener("unload",(function(){l()})),t.postMessage({id:"open-external-editor-input",payload:o},window.location.origin)):"save-external-editor-output"===i?(console.info('Received data from external editor "'.concat(r,'."')),u=s):"close"===e.data.id&&(t.close(),l())}else console.warn("Ignoring malformed message data from the external editor window.")};window.addEventListener("message",c);var l=function(){s||(s=!0,console.info('External editor "'.concat(r,'" closed.')),window.removeEventListener("message",c),e(u))};i.addEventListener("abort",(function(){n(new G.s("")),s||(t.close(),l())})),t.addEventListener("load",(function(){console.info('External editor "'.concat(r,'" loaded.')),a=!0,t.addEventListener("unload",(function(){l()}))})),t.location=_[r],setTimeout((function(){a||s||(console.info('External editor "'.concat(r,' not loaded after 10 seconds - closing its window."')),t.close(),l())}),1e4)})));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),W=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t,r,o,i,a,s;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.project,r=n.resourceNames,o=[],i=t.getResourcesManager(),r.forEach((function(e){if(i.hasResource(e)){var n=i.getResource(e).getFile();(0,M.PX)(n)?(0,M.Gu)(n)?console.error("Unsupported blob URL for a resource - ignoring it."):o.push({url:n,resourceName:e}):console.error("Unsupported local file for a resource - ignoring it.")}})),e.next=6,(0,O.R7)({urlContainers:o,onProgress:function(e,n){}});case 6:return a=e.sent,s=new Map,e.next=10,Promise.all(a.map(function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.error,t=n.blob,r=n.item,!t){e.next=15;break}return e.prev=2,e.t0=s,e.t1=r.resourceName,e.next=7,(0,O.oT)(t);case 7:e.t2=e.sent,e.t3={dataUrl:e.t2},e.t0.set.call(e.t0,e.t1,e.t3),e.next=15;break;case 12:e.prev=12,e.t4=e.catch(2),console.error('Unable to read data from resource "'.concat(r.resourceName,'" - ignoring it.'),e.t4);case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(n){return e.apply(this,arguments)}}()));case 10:return e.abrupt("return",r.map((function(e){var n=s.get(e);if(!n)return{name:e,dataUrl:""};var t=n.localFilePath;return{name:e,dataUrl:n.dataUrl,localFilePath:t}})));case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),J=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t,r,o,i,a,s,u,l,d,p,f,h,g,m;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.externalEditorName,r=n.externalEditorWindow,o=n.defaultName,i=n.metadataKey,a=n.resourceKind,s=n.options,u=s.project,l=s.resourceNames,d=s.resourceManagementProps,p=s.signal,e.next=4,W({project:u,resourceNames:l});case 4:return f=e.sent,h={singleFrame:s.extraOptions.singleFrame,externalEditorData:(0,A.Z2)(i,s.extraOptions.existingMetadata),fps:s.extraOptions.fps,isLooping:s.extraOptions.isLooping,name:s.extraOptions.name||l[0]||o,resources:f},(0,T.sY)(t),e.next=9,z({externalEditorWindow:r,externalEditorName:t,externalEditorInput:h,signal:p});case 9:if(g=e.sent){e.next=12;break}return e.abrupt("return",null);case 12:return e.next=14,(0,A.Zv)({baseNameForNewResources:g.baseNameForNewResources,project:u,resources:g.resources,resourceKind:a});case 14:return m=e.sent,e.prev=15,e.next=18,d.onFetchNewlyAddedResources();case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(15),console.error("An error happened while fetching the newly added resources:",e.t0);case 23:return(0,A.$N)({modifiedResources:m,metadataKey:i,metadata:s.extraOptions.singleFrame?g.externalEditorData:null}),(0,A.TD)(m.map((function(e){return e.resource.getName()})),g.externalEditorData),e.abrupt("return",{resources:m.map((function(e){var n=e.resource,t=e.originalIndex;return{name:n.getName(),originalIndex:t}})),newName:g.baseNameForNewResources,newMetadata:(0,I.Z)({},i,g.externalEditorData)});case 26:case"end":return e.stop()}}),e,null,[[15,20]])})));return function(n){return e.apply(this,arguments)}}(),H={id:"You need to save this project as a cloud project to install this asset. Please save your project and try again."},K=function(){var e="GDevelopExternalEditor"+B++,n=window.screenX+window.innerWidth/2-400,t=window.screenY+window.innerHeight/2-300,r=window.open("about:blank",e,"width=".concat(800,",height=").concat(600,",left=").concat(n,",top=").concat(t));if(!r)throw new Error("Can't open the external editor because of browser restrictions.");return L(r),r},Y=[{name:"piskel-app",createDisplayName:{id:"Create with Piskel"},editDisplayName:{id:"Edit with Piskel"},kind:"image",edit:function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Cloud"===n.getStorageProvider().internalName){e.next=4;break}return t=n.i18n,(0,U.T4)(t._(H),{delayToNextTick:!0}),e.abrupt("return",null);case 4:return r=K(),e.next=7,J({options:n,externalEditorWindow:r,externalEditorName:"piskel",defaultName:"New image",metadataKey:"pskl",resourceKind:"image"});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()},{name:"jfxr-app",createDisplayName:{id:"Create with Jfxr"},editDisplayName:{id:"Edit with Jfxr"},kind:"audio",edit:function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Cloud"===n.getStorageProvider().internalName){e.next=4;break}return t=n.i18n,(0,U.T4)(t._(H),{delayToNextTick:!0}),e.abrupt("return",null);case 4:return r=K(),e.next=7,J({options:n,externalEditorWindow:r,externalEditorName:"jfxr",defaultName:"New sound effect",metadataKey:"jfxr",resourceKind:"audio"});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()},{name:"yarn-app",createDisplayName:{id:"Create with Yarn"},editDisplayName:{id:"Edit with Yarn"},kind:"json",edit:function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Cloud"===n.getStorageProvider().internalName){e.next=4;break}return t=n.i18n,(0,U.T4)(t._(H),{delayToNextTick:!0}),e.abrupt("return",null);case 4:return r=K(),e.next=7,J({options:n,externalEditorWindow:r,externalEditorName:"yarn",defaultName:"New dialogue tree",metadataKey:"yarn",resourceKind:"json"});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}],V=Y,X=t(15671),Q=t(43144),q=t(60136),$=t(29388),ee=t(67835),ne=t(86278),te=function(e){(0,q.Z)(t,e);var n=(0,$.Z)(t);function t(){return(0,X.Z)(this,t),n.apply(this,arguments)}return(0,Q.Z)(t,[{key:"render",value:function(){var e=this.props,n=e.error,t=e.onClose;return(0,N.jsx)(p.I18n,{children:function(e){e.i18n;return(0,N.jsxs)(P.Z,{title:(0,N.jsx)(p.Trans,{id:"Could not launch the preview"}),actions:[(0,N.jsx)(ee.Z,{label:(0,N.jsx)(p.Trans,{id:"Close"}),onClick:t},"close")],onRequestClose:t,open:!0,children:[(0,N.jsx)(x.x1,{children:(0,N.jsx)(x.sg,{noMargin:!0,children:(0,N.jsx)(ne.Z,{children:"NetworkingError"===n.code?(0,N.jsx)(p.Trans,{id:"The preview could not be launched because you're offline."}):(0,N.jsx)(p.Trans,{id:"The preview could not be launched because an error happened: {0}.",values:{0:n.message}})})})}),(0,N.jsx)(x.x1,{children:(0,N.jsx)(x.sg,{noMargin:!0,children:(0,N.jsx)(ne.Z,{children:(0,N.jsx)(p.Trans,{id:"Make sure you're online, have a proper internet connection and try again. If you download and use GDevelop desktop application, you can also run previews without any internet connection."})})})})]})}})}}]),t}(o.Component),re=t(45911),oe=t(68151),ie=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,oe.SS)({uploadType:"preview",files:n.map((function(e){return{key:e.Key,contentType:e.ContentType}}))});case 2:if(t=e.sent,(r=t.signedUrls).length===n.length){e.next=6;break}throw new Error("Unexpected response from the API (signed urls count is not the same as uploaded objects count).");case 6:return e.next=8,Promise.all(n.map((function(e,n){return F().put(r[n],e.Body,{headers:{"Content-Type":e.ContentType}})})));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(){return re.fm.baseUrl},se=t.g.gd,ue=function(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("ftp://")||e.startsWith("blob:")||e.startsWith("data:")},ce=(0,Q.Z)((function e(n){var t=this,r=n.filesContent,o=n.prefix,i=n.bucketBaseUrl;(0,X.Z)(this,e),this._pendingUploadObjects=[],this._allCopiedExternalUrls=new Set,this.uploadPendingObjects=(0,l.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Uploading ".concat(t._pendingUploadObjects.length," files for preview...")),e.next=4,ie(t._pendingUploadObjects);case 4:console.log("Uploaded all ".concat(t._pendingUploadObjects.length," preview files.")),e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),console.error("Can't upload all objects:",e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),this.mkDir=function(e){},this.dirExists=function(e){return!0},this.clearDir=function(e){},this.getTempDir=function(){return"/virtual-unused-tmp-dir"},this.fileNameFrom=function(e){return ue(e)?e:m().basename(e)},this.dirNameFrom=function(e){return ue(e)?"":m().dirname(e)},this.makeAbsolute=function(e,n){return ue(e)?e:(t.isAbsolute(n)||(n=m().resolve(n)),m().resolve(n,m().normalize(e)))},this.makeRelative=function(e,n){return ue(e)?e:m().relative(n,m().normalize(e))},this.isAbsolute=function(e){return!!ue(e)||(0===e.length||(e.length>0&&"/"===e.charAt(0)||e.length>1&&":"===e.charAt(1)))},this.copyFile=function(e,n){return ue(e)?(t._allCopiedExternalUrls.add(e),!0):(console.warn("Copy not done from",e,"to",n),!0)},this.writeToFile=function(e,n){var r=e.replace(t.bucketBaseUrl,""),o=m().extname(e);return t._pendingUploadObjects.push({Key:r,Body:n,ContentType:{".js":"text/javascript",".html":"text/html"}[o]}),!0},this.readFile=function(e){return t._indexedFilesContent[e]?t._indexedFilesContent[e].text:(console.error("Unknown file ".concat(e,", returning an empty string")),"")},this.readDir=function(e,n){n=n.toUpperCase();var r=new se.VectorString;return t._allCopiedExternalUrls.forEach((function(e){var t=e.toUpperCase();t.indexOf(n)===t.length-n.length&&r.push_back(e)})),r},this.fileExists=function(e){return ue(e),!0},this.prefix=o,this.bucketBaseUrl=i,this._indexedFilesContent={},r.forEach((function(e){t._indexedFilesContent[e.filePath]=e}))})),le=t(52578),de={preview:["/Runtime/index.html"],web:["/Runtime/index.html","/Runtime/Electron/LICENSE.GDevelop.txt"],"cocos2d-js":["/Runtime/Cocos2d/cocos2d-js-v3.10.js","/Runtime/Cocos2d/index.html","/Runtime/Cocos2d/main.js","/Runtime/Cocos2d/project.json"],"facebook-instant-games":["/Runtime/FacebookInstantGames/fbapp-config.json","/Runtime/FacebookInstantGames/index.html"],cordova:["/Runtime/Cordova/www/index.html","/Runtime/Cordova/www/LICENSE.GDevelop.txt","/Runtime/Cordova/config.xml","/Runtime/Cordova/package.json"],electron:["/Runtime/index.html","/Runtime/Electron/main.js","/Runtime/Electron/package.json","/Runtime/Electron/LICENSE.GDevelop.txt"]},pe=function(e){var n="https://resources.gdevelop-app.com/GDJS-".concat((0,le.r1)());return Promise.all(de[e].map((function(e){var t=n+e;return fetch(t).then((function(e){if(!e.ok)throw console.error('Error while downloading "'.concat(t,'"'),e),new Error('Error while downloading "'.concat(t,'" (status: ').concat(e.status,")"));return e.text().then((function(e){return{filePath:t,text:e}}))}))}))).then((function(e){return{gdjsRoot:n,filesContent:e}}))},fe=t(25842),he=t.n(fe),ge=t(28842),me="stopped",xe=[],ve=0,we={},be=function(){return Object.keys(we).map((function(e){return Number(e)}))},je=function(e){for(var n in we){var t=Number(n);if(we[t]===e)return t}return null},ye=null,Fe=function(){null===ye&&(ye=setInterval((function(){var e=function(){var e=Number(n);we[e].closed&&(console.info("A preview window was closed, with debugger id:",e),delete we[e],xe.forEach((function(n){return(0,n.onConnectionClosed)({id:e,debuggerIds:be()})})),Object.keys(we).length||(clearInterval(ye),ye=null))};for(var n in we)e()}),1e3))},ke="https://game-previews.gdevelop.io",Se={startServer:function(){var e=(0,l.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("started"!==me){e.next=2;break}return e.abrupt("return");case 2:me="started",window.addEventListener("message",(function(e){if(e.origin===ke){var n=je(e.source);if(null!==n)try{var t=JSON.parse(e.data);xe.forEach((function(e){return(0,e.onHandleParsedMessage)({id:n,parsedMessage:t})}))}catch(r){console.error("Error while parsing messages coming from a preview:",r)}}})),Fe(),xe.forEach((function(e){return(0,e.onServerStateChanged)()}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),sendMessage:function(e,n){var t=we[e];if(t)try{t.postMessage(n,ke)}catch(r){console.error("Unable to send a message to the preview window:",r)}},getServerState:function(){return me},getExistingDebuggerIds:be,registerCallbacks:function(e){return xe.push(e),function(){var n=xe.indexOf(e);-1!==n&&xe.splice(n,1)}}},Ee=function(e){var n=ve++;return we[n]=e,Fe(),xe.forEach((function(e){return(0,e.onConnectionOpened)({id:n,debuggerIds:be()})})),n},Pe=t(34517),Ze=t(48409),Ne=t.g.gd,Re=0,Ce=function(e){var n=e.getGameResolutionWidth(),t=e.getGameResolutionHeight(),r=window.screenX+window.innerWidth/2-n/2,o=window.screenY+window.innerHeight/2-t/2,i="GDevelopPreview"+Re++,a=window.open("about:blank",i,"width=".concat(n,",height=").concat(t,",left=").concat(r,",top=").concat(o));if(!a)throw new Error("Can't open the preview window because of browser restrictions.");return L(a),a},De=function(e){(0,q.Z)(t,e);var n=(0,$.Z)(t);function t(){var e;(0,X.Z)(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=n.call.apply(n,[this].concat(o))).canDoNetworkPreview=function(){return!1},e.canDoHotReload=function(){return!1},e.state={error:null},e._prepareExporter=function(){return pe("preview").then((function(e){var n=e.gdjsRoot,t=e.filesContent;console.info("GDJS found in ",n);var r=(0,ge._)(),o=ae()+r,i=new ce({filesContent:t,bucketBaseUrl:ae(),prefix:r}),a=he()(new Ne.AbstractFileSystemJS,i),s=new Ne.Exporter(a,n);return s.setCodeOutputDirectory(o),{exporter:s,outputDir:o,browserS3FileSystem:i}}))},e.launchPreview=function(){var n=(0,l.Z)((0,c.Z)().mark((function n(t){var r,o,i,s,u,d,p,f,h,g,m,x,v,w,b;return(0,c.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.project,o=t.layout,i=t.externalLayout,s=t.numberOfWindows,e.setState({error:null}),u=e.getPreviewDebuggerServer().getExistingDebuggerIds(),d=u.length?u[u.length-1]:null,p=t.hotReload&&null!==d,f=p?null==(j=d)?null:we[j]||null:null,h=f?[f]:Array.from({length:s},(function(){try{return Ce(r)}catch(e){return console.error("Unable to open a new preview window - this window will be ignored:",e),null}})).filter(Boolean),n.prev=7,n.next=10,e.getPreviewDebuggerServer().startServer();case 10:n.next=15;break;case 12:n.prev=12,n.t0=n.catch(7),console.error("Unable to start the Debugger Server for the preview:",n.t0);case 15:return n.prev=15,n.next=18,e._prepareExporter();case 18:return g=n.sent,m=g.exporter,x=g.outputDir,v=g.browserS3FileSystem,(w=new Ne.PreviewExportOptions(r,x)).setLayoutName(o.getName()),w.setIsDevelopmentEnvironment(a.ZP.isDev()),i&&w.setExternalLayoutName(i.getName()),(0,Ze._F)()?w.useMinimalDebuggerClient():w.useWindowMessageDebuggerClient(),w.setNonRuntimeScriptsCacheBurst(Date.now()),w.setFullLoadingScreen(t.fullLoadingScreen),w.setNativeMobileApp((0,Ze._F)()),w.setGDevelopVersionWithHash((0,le.Us)()),w.setCrashReportUploadLevel(e.props.crashReportUploadLevel),w.setPreviewContext(e.props.previewContext),w.setProjectTemplateSlug(r.getTemplateSlug()),w.setSourceGameId(e.props.sourceGameId),t.inAppTutorialMessageInPreview&&w.setInAppTutorialMessageInPreview(t.inAppTutorialMessageInPreview,t.inAppTutorialMessagePositionInPreview),t.fallbackAuthor&&w.setFallbackAuthor(t.fallbackAuthor.id,t.fallbackAuthor.username),t.authenticatedPlayer&&w.setAuthenticatedPlayer(t.authenticatedPlayer.playerId,t.authenticatedPlayer.playerUsername,t.authenticatedPlayer.playerToken),t.captureOptions.screenshots&&t.captureOptions.screenshots.forEach((function(e){w.addScreenshotCapture(e.delayTimeInSeconds,e.signedUrl,e.publicUrl)})),(b=(0,Pe.NC)())&&w.setGDevelopResourceToken(b),m.exportProjectForPixiPreview(w),w.delete(),m.delete(),n.next=46,v.uploadPendingObjects();case 46:h.forEach((function(e){e.location=x+"/index.html";try{e.focus()}catch(n){}})),f||h.forEach((function(n){var r=Ee(n);Se.registerCallbacks({onErrorReceived:function(){},onServerStateChanged:function(){},onConnectionClosed:function(){var n=(0,l.Z)((0,c.Z)().mark((function n(o){return(0,c.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o.id===r){n.next=3;break}return n.abrupt("return");case 3:if(!t.captureOptions){n.next=6;break}return n.next=6,e.props.onCaptureFinished(t.captureOptions);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),onConnectionOpened:function(){},onConnectionErrored:function(){},onHandleParsedMessage:function(){}})})),n.next=53;break;case 50:n.prev=50,n.t1=n.catch(15),e.setState({error:n.t1});case 53:case"end":return n.stop()}var j}),n,null,[[7,12],[15,50]])})));return function(e){return n.apply(this,arguments)}}(),e}return(0,Q.Z)(t,[{key:"getPreviewDebuggerServer",value:function(){return Se}},{key:"render",value:function(){var e=this,n=this.state.error;return n?(0,N.jsx)(te,{error:n,onClose:function(){return e.setState({error:null})}}):null}}]),t}(o.Component),Ie=t(10959),Ae=t(98775),Te=t.g.gd,Me=function(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("ftp://")||e.startsWith("blob:")||e.startsWith("data:")},Oe=m().posix||m(),Ue=(0,Q.Z)((function e(n){var t=this,r=n.textFiles;(0,X.Z)(this,e),this._textFiles={},this._filesToDownload={},this.getAllTextFilesIn=function(e){return Object.keys(t._textFiles).filter((function(n){return 0===n.indexOf(e)})).map((function(e){return{filePath:e,text:t._textFiles[e]}}))},this.getAllUrlFilesIn=function(e){return Object.keys(t._filesToDownload).filter((function(n){return 0===n.indexOf(e)})).map((function(e){return{filePath:e,url:t._filesToDownload[e]}}))},this.mkDir=function(e){return!0},this.dirExists=function(e){return!0},this.clearDir=function(e){return Object.keys(t._textFiles).forEach((function(n){0===n.indexOf(e)&&delete t._textFiles[n]})),!0},this.getTempDir=function(){return"/browser-file-system-tmp-dir"},this.fileNameFrom=function(e){return Oe.basename(e)},this.dirNameFrom=function(e){return Oe.dirname(e)},this.makeAbsolute=function(e,n){return Me(e)?e:(t.isAbsolute(n)||(n=Oe.resolve(n)),Oe.resolve(n,Oe.normalize(e)))},this.makeRelative=function(e,n){return Me(e)?0===e.indexOf(n)?e.substring(n.length):(console.warn("".concat(e," cannot be made relative to ").concat(n,", please double check this behavior is correct.")),e):Oe.relative(n,Oe.normalize(e))},this.isAbsolute=function(e){return!!Me(e)||e.length>0&&"/"===e.charAt(0)},this.copyFile=function(e,n){if(Me(e))return Me(n)?(console.error("Destination can't be a URL in copyFile (from ".concat(e," to ").concat(n,").")),!1):(t._filesToDownload[Oe.normalize(n)]=e,!0);if(t._textFiles[e])return t._textFiles[Oe.normalize(n)]=t._textFiles[e],!0;var r=Object.keys(t._filesToDownload).find((function(n){return n===e}));if(r){var o=t._filesToDownload[r];return t._filesToDownload[Oe.normalize(n)]=o,!0}return console.error("File not found in copyFile (from ".concat(e," to ").concat(n,").")),!1},this.writeToFile=function(e,n){return t._textFiles[Oe.normalize(e)]=n,!0},this.readFile=function(e){return t._textFiles[e]?t._textFiles[e]:(console.error("Unknown file ".concat(e,", returning an empty string")),"")},this.readDir=function(e,n){n=n.toUpperCase();var r=new Te.VectorString;return Object.keys(t._filesToDownload).forEach((function(e){var t=e.toUpperCase();t.indexOf(n)===t.length-n.length&&r.push_back(e)})),r},this.fileExists=function(e){if(Me(e))return!0;var n=Oe.normalize(e);return!!t._textFiles[n]||!!t._filesToDownload[n]},r.forEach((function(e){t._textFiles[e.filePath]=e.text}))})),Le=t(96826),Ge=t(61421),Be=t.g.gd,_e="browser-online-cordova",ze={name:_e,onlineBuildType:"cordova-build",limitedBuilds:!0,packageNameWarningType:"mobile",getInitialExportState:function(){return{targets:["androidApk"],keystore:"new",signingDialogOpen:!1}},canLaunchBuild:function(e,n,t){return n||""===t},isNavigationDisabled:function(e,n){return!n&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,N.jsx)(Ge.s_,(0,r.Z)({},e))},shouldSuggestBumpingVersionNumber:function(){return!0},renderExportFlow:function(e){return(0,N.jsx)(Ge.yg,(0,r.Z)((0,r.Z)({},e),{},{exportPipelineName:_e}))},prepareExporter:function(e){return pe("cordova").then((function(e){var n=e.gdjsRoot,t=e.filesContent;console.info("GDJS found in ",n);var r=new Ue({textFiles:t}),o=he()(new Be.AbstractFileSystemJS,r);return{exporter:new Be.Exporter(o,n),outputDir:"/export/",abstractFileSystem:r}}))},launchExport:function(e,n,t){var r=n.exporter,o=n.outputDir,i=n.abstractFileSystem,a=e.project,s=new Be.ExportOptions(a,o);return s.setTarget("cordova"),t&&s.setFallbackAuthor(t.id,t.username),r.exportWholePixiProject(s),s.delete(),r.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,n){var t=n.textFiles,r=n.urlFiles;return(0,Le.I)({urlFiles:r,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:t}}))},launchCompression:function(e,n){var t=n.textFiles,r=n.blobFiles;return(0,Le.f)({blobFiles:r,textFiles:t,basePath:"/export/",onProgress:e.updateStepProgress})},launchUpload:function(e,n){return(0,Ie.Zi)().then((function(t){return(0,Ae.n)(n,t,e.updateStepProgress).then((function(){return t.key}))}))},launchOnlineBuild:function(e,n,t,r,o,i){var a=n.getAuthorizationHeader,s=n.firebaseUser;return s?(0,Ie.$C)(a,s.uid,t,e.targets,e.keystore,r,o,i):Promise.reject(new Error("User is not authenticated"))}},We=t(90078),Je=t.g.gd,He="browser-online-cordova-ios",Ke={name:He,onlineBuildType:"cordova-ios-build",limitedBuilds:!0,packageNameWarningType:"mobile",getInitialExportState:function(){return{targets:["iosAppStore"],signing:null}},canLaunchBuild:function(e,n,t){return(n||""===t)&&!!e.signing},isNavigationDisabled:function(e,n){return!n&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,N.jsx)(We.s_,(0,r.Z)({},e))},shouldSuggestBumpingVersionNumber:function(){return!0},renderExportFlow:function(e){return(0,N.jsx)(We.yg,(0,r.Z)((0,r.Z)({},e),{},{exportPipelineName:He}))},prepareExporter:function(e){return pe("cordova").then((function(e){var n=e.gdjsRoot,t=e.filesContent;console.info("GDJS found in ",n);var r=new Ue({textFiles:t}),o=he()(new Je.AbstractFileSystemJS,r);return{exporter:new Je.Exporter(o,n),outputDir:"/export/",abstractFileSystem:r}}))},launchExport:function(e,n,t){var r=n.exporter,o=n.outputDir,i=n.abstractFileSystem,a=e.project,s=new Je.ExportOptions(a,o);return s.setTarget("cordova"),t&&s.setFallbackAuthor(t.id,t.username),r.exportWholePixiProject(s),s.delete(),r.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,n){var t=n.textFiles,r=n.urlFiles;return(0,Le.I)({urlFiles:r,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:t}}))},launchCompression:function(e,n){var t=n.textFiles,r=n.blobFiles;return(0,Le.f)({blobFiles:r,textFiles:t,basePath:"/export/",onProgress:e.updateStepProgress})},launchUpload:function(e,n){return(0,Ie.Zi)().then((function(t){return(0,Ae.n)(n,t,e.updateStepProgress).then((function(){return t.key}))}))},launchOnlineBuild:function(e,n,t,r,o,i){var a=n.getAuthorizationHeader,s=n.profile;return s?e.signing?(0,Ie.NZ)(a,s.id,t,e.targets,e.signing,r,o,i):Promise.reject(new Error("Signing options not set up")):Promise.reject(new Error("User is not authenticated"))}},Ye=t(87335),Ve=t.g.gd,Xe="browser-online-electron",Qe={name:Xe,onlineBuildType:"electron-build",limitedBuilds:!0,packageNameWarningType:"desktop",getInitialExportState:function(){return{targets:["winExe"]}},canLaunchBuild:function(e,n,t){return!!e.targets.length&&(n||""===t)},isNavigationDisabled:function(e,n){return!n&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,N.jsx)(Ye.s_,(0,r.Z)({},e))},renderExportFlow:function(e){return(0,N.jsx)(Ye.yg,(0,r.Z)((0,r.Z)({},e),{},{exportPipelineName:Xe}))},prepareExporter:function(e){return pe("electron").then((function(e){var n=e.gdjsRoot,t=e.filesContent;console.info("GDJS found in ",n);var r=new Ue({textFiles:t}),o=he()(new Ve.AbstractFileSystemJS,r);return{exporter:new Ve.Exporter(o,n),outputDir:"/export/",abstractFileSystem:r}}))},launchExport:function(e,n,t){var r=n.exporter,o=n.outputDir,i=n.abstractFileSystem,a=e.project,s=new Ve.ExportOptions(a,o);return s.setTarget("electron"),t&&s.setFallbackAuthor(t.id,t.username),r.exportWholePixiProject(s),s.delete(),r.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,n){var t=n.textFiles,r=n.urlFiles;return(0,Le.I)({urlFiles:r,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:t}}))},launchCompression:function(e,n){var t=n.textFiles,r=n.blobFiles;return(0,Le.f)({blobFiles:r,textFiles:t,basePath:"/export/",onProgress:e.updateStepProgress})},launchUpload:function(e,n){return(0,Ie.Zi)().then((function(t){return(0,Ae.n)(n,t,e.updateStepProgress).then((function(){return t.key}))}))},launchOnlineBuild:function(e,n,t,r,o,i){var a=n.getAuthorizationHeader,s=n.firebaseUser;return s?(0,Ie.ch)(a,s.uid,t,e.targets,r,o,i):Promise.reject(new Error("User is not authenticated"))}},qe=t(96516),$e=t(4615),en=t.g.gd,nn="browser-online-web",tn={name:nn,onlineBuildType:"web-build",getInitialExportState:function(){return null},canLaunchBuild:function(e,n,t){return n||""===t||"done"===t},isNavigationDisabled:function(e,n){return!n&&!["","done"].includes(e)},renderHeader:function(e){var n=e.uiMode;return(0,N.jsx)(qe.if,{uiMode:n})},renderExportFlow:function(e){return(0,N.jsx)($e.Z,(0,r.Z)((0,r.Z)({},e),{},{exportPipelineName:nn}))},prepareExporter:function(e){return pe("web").then((function(e){var n=e.gdjsRoot,t=e.filesContent;console.info("GDJS found in ",n);var r=new Ue({textFiles:t}),o=he()(new en.AbstractFileSystemJS,r);return{exporter:new en.Exporter(o,n),outputDir:"/export/",abstractFileSystem:r}}))},launchExport:function(e,n,t){var r=n.exporter,o=n.outputDir,i=n.abstractFileSystem,a=e.project,s=new en.ExportOptions(a,o);return t&&s.setFallbackAuthor(t.id,t.username),r.exportWholePixiProject(s),s.delete(),r.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,n){var t=n.textFiles,r=n.urlFiles;return(0,Le.I)({urlFiles:r,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:t}}))},launchCompression:function(e,n){var t=n.textFiles,r=n.blobFiles;return(0,Le.f)({blobFiles:r,textFiles:t,basePath:"/export/",onProgress:e.updateStepProgress,sizeLimit:25e7})},launchUpload:function(e,n){return(0,Ie.Zi)().then((function(t){return(0,Ae.n)(n,t,e.updateStepProgress).then((function(){return t.key}))}))},launchOnlineBuild:function(e,n,t,r,o,i){var a=n.getAuthorizationHeader,s=n.firebaseUser;return s?(0,Ie.Bc)(a,s.uid,t,r,o,i):Promise.reject(new Error("User is not authenticated"))}},rn=t(37054),on=t(39935),an=t.g.gd,sn="browser-html5",un={name:sn,getInitialExportState:function(){return null},canLaunchBuild:function(){return!0},isNavigationDisabled:function(){return!1},renderHeader:function(){return(0,N.jsx)(on.if,{})},renderExportFlow:function(e){return(0,N.jsx)(on.yg,(0,r.Z)((0,r.Z)({},e),{},{exportPipelineName:sn}))},prepareExporter:function(e){return pe("web").then((function(e){var n=e.gdjsRoot,t=e.filesContent;console.info("GDJS found in ",n);var r=new Ue({textFiles:t}),o=he()(new an.AbstractFileSystemJS,r);return{exporter:new an.Exporter(o,n),outputDir:"/export/",abstractFileSystem:r}}))},launchExport:function(e,n,t){var r=n.exporter,o=n.outputDir,i=n.abstractFileSystem,a=e.project,s=new an.ExportOptions(a,o);return t&&s.setFallbackAuthor(t.id,t.username),r.exportWholePixiProject(s),s.delete(),r.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,n){var t=n.textFiles,r=n.urlFiles;return(0,Le.I)({urlFiles:r,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:t}}))},launchCompression:function(e,n){var t=n.textFiles,r=n.blobFiles;return(0,Le.f)({blobFiles:r,textFiles:t,basePath:"/export/",onProgress:e.updateStepProgress})},renderDoneFooter:function(e){var n=e.compressionOutput;e.exportState;return(0,N.jsx)(on.Eg,{renderGameButton:function(){return(0,N.jsx)(rn.j,{blob:n,children:function(e){return(0,N.jsx)(w.Z,{primary:!0,onClick:function(){return(0,rn.z)(e,"game.zip")},label:(0,N.jsx)(p.Trans,{id:"Download the exported game"})})}})}})}},cn=t(76349),ln=t.g.gd,dn="browser-cordova",pn={name:dn,packageNameWarningType:"mobile",getInitialExportState:function(){return null},canLaunchBuild:function(){return!0},isNavigationDisabled:function(){return!1},renderHeader:function(){return(0,N.jsx)(cn.if,{})},renderExportFlow:function(e){return(0,N.jsx)(cn.yg,(0,r.Z)((0,r.Z)({},e),{},{exportPipelineName:dn}))},prepareExporter:function(e){return pe("cordova").then((function(e){var n=e.gdjsRoot,t=e.filesContent;console.info("GDJS found in ",n);var r=new Ue({textFiles:t}),o=he()(new ln.AbstractFileSystemJS,r);return{exporter:new ln.Exporter(o,n),outputDir:"/export/",abstractFileSystem:r}}))},launchExport:function(e,n,t){var r=n.exporter,o=n.outputDir,i=n.abstractFileSystem,a=e.project,s=new ln.ExportOptions(a,o);return s.setTarget("cordova"),t&&s.setFallbackAuthor(t.id,t.username),r.exportWholePixiProject(s),s.delete(),r.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,n){var t=n.textFiles,r=n.urlFiles;return(0,Le.I)({urlFiles:r,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:t}}))},launchCompression:function(e,n){var t=n.textFiles,r=n.blobFiles;return(0,Le.f)({blobFiles:r,textFiles:t,basePath:"/export/",onProgress:e.updateStepProgress})},renderDoneFooter:function(e){var n=e.compressionOutput;e.exportState;return(0,N.jsx)(cn.Eg,{renderGameButton:function(){return(0,N.jsx)(rn.j,{blob:n,children:function(e){return(0,N.jsx)(w.Z,{primary:!0,onClick:function(){return(0,rn.z)(e,"game.zip")},label:(0,N.jsx)(p.Trans,{id:"Download the exported game"})})}})}})}},fn=t(41426),hn=t.g.gd,gn="browser-electron",mn={name:gn,packageNameWarningType:"desktop",getInitialExportState:function(){return null},canLaunchBuild:function(){return!0},isNavigationDisabled:function(){return!1},renderHeader:function(){return(0,N.jsx)(fn.if,{})},renderExportFlow:function(e){return(0,N.jsx)(fn.yg,(0,r.Z)((0,r.Z)({},e),{},{exportPipelineName:gn}))},prepareExporter:function(e){return pe("electron").then((function(e){var n=e.gdjsRoot,t=e.filesContent;console.info("GDJS found in ",n);var r=new Ue({textFiles:t}),o=he()(new hn.AbstractFileSystemJS,r);return{exporter:new hn.Exporter(o,n),outputDir:"/export/",abstractFileSystem:r}}))},launchExport:function(e,n,t){var r=n.exporter,o=n.outputDir,i=n.abstractFileSystem,a=e.project,s=new hn.ExportOptions(a,o);return s.setTarget("electron"),t&&s.setFallbackAuthor(t.id,t.username),r.exportWholePixiProject(s),s.delete(),r.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,n){var t=n.textFiles,r=n.urlFiles;return(0,Le.I)({urlFiles:r,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:t}}))},launchCompression:function(e,n){var t=n.textFiles,r=n.blobFiles;return(0,Le.f)({blobFiles:r,textFiles:t,basePath:"/export/",onProgress:e.updateStepProgress})},renderDoneFooter:function(e){var n=e.compressionOutput;e.exportState;return(0,N.jsx)(fn.Eg,{renderGameButton:function(){return(0,N.jsx)(rn.j,{blob:n,children:function(e){return(0,N.jsx)(w.Z,{primary:!0,onClick:function(){return(0,rn.z)(e,"game.zip")},label:(0,N.jsx)(p.Trans,{id:"Download the exported game"})})}})}})}},xn=t(15745),vn=t.g.gd,wn="browser-facebook-instant-games",bn={name:wn,getInitialExportState:function(){return null},canLaunchBuild:function(){return!0},isNavigationDisabled:function(){return!1},renderHeader:function(){return(0,N.jsx)(xn.if,{})},renderExportFlow:function(e){return(0,N.jsx)(xn.yg,(0,r.Z)((0,r.Z)({},e),{},{exportPipelineName:wn}))},prepareExporter:function(e){return pe("facebook-instant-games").then((function(e){var n=e.gdjsRoot,t=e.filesContent;console.info("GDJS found in ",n);var r=new Ue({textFiles:t}),o=he()(new vn.AbstractFileSystemJS,r);return{exporter:new vn.Exporter(o,n),outputDir:"/export/",abstractFileSystem:r}}))},launchExport:function(e,n,t){var r=n.exporter,o=n.outputDir,i=n.abstractFileSystem,a=e.project,s=new vn.ExportOptions(a,o);return s.setTarget("facebookInstantGames"),t&&s.setFallbackAuthor(t.id,t.username),r.exportWholePixiProject(s),s.delete(),r.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,n){var t=n.textFiles,r=n.urlFiles;return(0,Le.I)({urlFiles:r,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:t}}))},launchCompression:function(e,n){var t=n.textFiles,r=n.blobFiles;return(0,Le.f)({blobFiles:r,textFiles:t,basePath:"/export/",onProgress:e.updateStepProgress})},renderDoneFooter:function(e){var n=e.compressionOutput;e.exportState;return(0,N.jsx)(xn.Eg,{renderGameButton:function(){return(0,N.jsx)(rn.j,{blob:n,children:function(e){return(0,N.jsx)(w.Z,{primary:!0,onClick:function(){return(0,rn.z)(e,"fb-instant-game.zip")},label:(0,N.jsx)(p.Trans,{id:"Download the Instant Game archive"})})}})}})}},jn=(0,r.Z)((0,r.Z)({},qe.O1),{},{exportPipeline:tn}),yn=[(0,r.Z)((0,r.Z)({},on.BN),{},{exportPipeline:un}),(0,r.Z)((0,r.Z)({},Ge.Vf),{},{exportPipeline:ze}),(0,r.Z)((0,r.Z)({},We.Y$),{},{exportPipeline:Ke}),(0,r.Z)((0,r.Z)({},Ye.OL),{},{exportPipeline:Qe}),(0,r.Z)((0,r.Z)({},xn.xu),{},{exportPipeline:bn})],Fn=[(0,r.Z)((0,r.Z)({},on.BN),{},{exportPipeline:un}),(0,r.Z)((0,r.Z)({},cn.VU),{},{exportPipeline:pn}),(0,r.Z)((0,r.Z)({},fn.c8),{},{exportPipeline:mn})],kn=t(23570),Sn=t(92666),En=t(29571),Pn=t.g.gd,Zn=[{name:"AdMob",extensionModule:t(94550),objectsRenderingServiceModules:{}},{name:"AdvancedWindow",extensionModule:t(19910),objectsRenderingServiceModules:{}},{name:"FacebookInstantGames",extensionModule:t(64579),objectsRenderingServiceModules:{}},{name:"DeviceSensors",extensionModule:t(89493),objectsRenderingServiceModules:{}},{name:"DeviceVibration",extensionModule:t(27272),objectsRenderingServiceModules:{}},{name:"DebuggerTools",extensionModule:t(37515),objectsRenderingServiceModules:{}},{name:"Physics2",extensionModule:t(30269),objectsRenderingServiceModules:{}},{name:"Physics3D",extensionModule:t(87963),objectsRenderingServiceModules:{}},{name:"ExampleJsExtension",extensionModule:t(97854),objectsRenderingServiceModules:{}},{name:"Tween",extensionModule:t(43386),objectsRenderingServiceModules:{}},{name:"Video",extensionModule:t(24895),objectsRenderingServiceModules:{}},{name:"FileSystem",extensionModule:t(98261),objectsRenderingServiceModules:{}},{name:"Firebase",extensionModule:t(81386),objectsRenderingServiceModules:{}},{name:"Leaderboards",extensionModule:t(92268),objectsRenderingServiceModules:{}},{name:"PlayerAuthentication",extensionModule:t(17681),objectsRenderingServiceModules:{}},{name:"Multiplayer",extensionModule:t(93498),objectsRenderingServiceModules:{}},{name:"DialogueTree",extensionModule:t(99548),objectsRenderingServiceModules:{}},{name:"BBText",extensionModule:t(73118),objectsRenderingServiceModules:{"pixi-multistyle-text/dist/pixi-multistyle-text.umd":t(54505)}},{name:"TileMap",extensionModule:t(24767),objectsRenderingServiceModules:{"pixi-tilemap/dist/pixi-tilemap.umd":t(19477),"helper/TileMapHelper":t(69835),"pako/dist/pako.min":t(53663)}},{name:"Effects",extensionModule:t(44344),objectsRenderingServiceModules:{}},{name:"P2P",extensionModule:t(82240),objectsRenderingServiceModules:{}},{name:"Lighting",extensionModule:t(72025),objectsRenderingServiceModules:{}},{name:"SpatialSound",extensionModule:t(83915),objectsRenderingServiceModules:{}},{name:"BitmapText",extensionModule:t(68722),objectsRenderingServiceModules:{}},{name:"Screenshot",extensionModule:t(93905),objectsRenderingServiceModules:{}},{name:"TextInput",extensionModule:t(88306),objectsRenderingServiceModules:{}},{name:"Scene3D",extensionModule:t(11050),objectsRenderingServiceModules:{}},{name:"SpineObject",extensionModule:t(68708),objectsRenderingServiceModules:{}}];function Nn(e){var n=e.objectsEditorService,t=e.objectsRenderingService,r=e.filterExamples;return{loadAllExtensions:function(e){var o=Zn.filter((function(e){var n=e.name;return!r||!n.includes("Example")})).map((function(r){var o=r.name,i=r.extensionModule,a=r.objectsRenderingServiceModules;if(n&&i.registerEditorConfigurations&&i.registerEditorConfigurations(n),t){if(a)for(var s in a)t.registerModule(s,a[s]);i.registerInstanceRenderers&&i.registerInstanceRenderers(t),i.registerClearCache&&i.registerClearCache(t)}return{extensionModulePath:"internal-extension://"+o,result:(0,kn.loadExtension)(e,Pn,Pn.JsPlatform.get(),i)}})),i=function(e){var n=e.filterExamples;return Zn.filter((function(e){var t=e.name;return!n||!t.includes("Example")})).length}({filterExamples:r});return Promise.resolve({results:o,expectedNumberOfJSExtensionModulesLoaded:i})}}}var Rn=t(91479),Cn=t.n(Rn),Dn=t(71046),In=[],An=t.n(Dn)()((0,l.Z)((0,c.Z)().mark((function e(){var n;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,u.Z)(In),console.info("Uploading a batch of ".concat(n.length," extension generated files..."),n),In=[],e.prev=3,e.next=6,ie(n.map((function(e){return e.uploadedObject})));case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(3),n.forEach((function(n){return n.onError(e.t0)})),e.abrupt("return");case 12:n.forEach((function(e){return e.onSuccess()}));case 13:case"end":return e.stop()}}),e,null,[[3,8]])}))),10),Tn=function(e){return new Promise((function(n,t){In.push({uploadedObject:e,onSuccess:n,onError:t}),An()}))},Mn=function(e){var n=e.onWriteFile,t=(0,ge._)(),r=function(e){return"".concat(t,"/").concat(Cn()(e),".js")};return{getIncludeFileFor:function(e){return ae()+r(e)},writeFunctionCode:function(e,t){var o=r(e);return n({includeFile:o,content:t}),console.log("Uploading function generated code to ".concat(o,"...")),Tn({Key:r(e),Body:t,ContentType:"text/javascript"})},writeBehaviorCode:function(e,t){var o=r(e);return n({includeFile:o,content:t}),console.log("Uploading behavior generated code to ".concat(o,"...")),Tn({Key:r(e),Body:t,ContentType:"text/javascript"})},writeObjectCode:function(e,t){var o=r(e);return n({includeFile:o,content:t}),console.log("Uploading object generated code to ".concat(o,"...")),Tn({Key:r(e),Body:t,ContentType:"text/javascript"})}}},On=t(42063),Un=t(56924),Ln=t(8018),Gn=t(41006),Bn=t(78118),_n=o.memo((function(e){return(0,N.jsx)(Bn.Z,(0,r.Z)((0,r.Z)({},e),{},{children:(0,N.jsx)("path",{d:"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z"})}))})),zn=t(95018),Wn="AIzaSyDJYQmzLCfjXnNImDa1X_cDTWjl2BOrcM4",Jn=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],Hn="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.install",Kn=!1,Yn=null,Vn=function(){return Kn?Promise.resolve():Yn||(Yn=(0,zn.v)("https://apis.google.com/js/api:client.js").then((function(){var e=t.g.gapi;if(!e)throw new Error("No gapi global object found after loading Google Drive API script");return new Promise((function(n,t){e.load("client:auth2:picker",{callback:function(){var t=e.auth2.init({apiKey:Wn,clientId:"44882707384-3t4tubr3fbht87sbtdp7u5mlo45k5uku.apps.googleusercontent.com",discoveryDocs:Jn,scope:Hn});e.client.setApiKey(Wn);var r=e.client.load("drive","v3");n(Promise.all([t,r]))},onerror:function(){t(new Error("Unable to load auth2 and picker APIs for Google Drive."))}})}))})).then((function(){Kn=!0,Yn=null})).catch((function(e){throw console.error("Error while loading Google Drive APIs:",e),Yn=null,e})))},Xn=!1,Qn=function(){return Vn().then((function(){var e=t.g.gapi.auth2.getAuthInstance();return Xn&&e.isSignedIn.get()?e.currentUser.get():(Xn=!1,e.isSignedIn.listen((function(e){console.info("Authenticated with Google APIs: ",e),Xn=e})),e.signIn({scope:Hn}).then((function(e){if(!e.getAuthResponse()||e.getAuthResponse().error)throw console.error("OAuth2 error while sign in:",e.getAuthResponse()?e.getAuthResponse().error:"No AuthResponse"),new Error("Authentication error");return Xn=!0,e})))}))},qn={internalName:"GoogleDrive",name:{id:"Google Drive"},hiddenInSaveDialog:!0,renderIcon:function(e){return(0,N.jsx)(_n,{fontSize:e.size})},getFileMetadataFromAppArguments:function(e){if(e.state)try{var n=JSON.parse(e.state);if(n.ids&&n.ids[0])return{fileIdentifier:n.ids[0]}}catch(t){console.warn("Error while trying to parse the Google Drive 'ids' in 'state' from the app arguments.")}return null},createOperations:function(e){e.setDialog,e.closeDialog;return Vn().catch((function(){})),{doesInitialOpenRequireUserInteraction:!0,onOpen:function(e){var n=e.fileIdentifier;return Qn().then((function(e){return fetch("https://www.googleapis.com/drive/v3/files/".concat(n,"?alt=media"),{method:"GET",headers:new Headers({Authorization:"Bearer ".concat(e.getAuthResponse().access_token)})})})).then((function(e){return e.text().then((function(e){return new Promise((function(t,r){try{return t({content:JSON.parse(e)})}catch(o){return r(n+" is a corrupted/malformed file.")}}))}),(function(e){throw console.error("Error while reading the file from Google Drive API: ",e),e}))}),(function(e){throw console.error("Error while fetching the file from Google Drive API: ",e),e}))},onOpenWithPicker:function(){return Qn().then((function(e){return function(e){var n=e.selectFolderEnabled,r=e.showUploadView;return Qn().then((function(e){var o=t.g.google;return new Promise((function(t){var i=null,a=(new o.picker.PickerBuilder).addView((new o.picker.DocsView).setIncludeFolders(!0).setSelectFolderEnabled(n)).setOAuthToken(e.getAuthResponse().access_token).setDeveloperKey(Wn).setAppId("44882707384").setCallback((function(e){if(e[o.picker.Response.ACTION]===o.picker.Action.PICKED){var n=e[o.picker.Response.DOCUMENTS][0],r=n[o.picker.Document.ID],a=n[o.picker.Document.NAME],s=n[o.picker.Document.PARENT_ID];n[o.picker.Document.TYPE]===o.picker.Type.LOCATION||"application/vnd.google-apps.folder"===n[o.picker.Document.MIME_TYPE]?t({id:r,name:a,type:"FOLDER"}):t({id:r,name:a,type:"FILE",parentId:s}),i&&i.dispose()}else e[o.picker.Response.ACTION]===o.picker.Action.CANCEL&&(t(null),i&&i.dispose())}));r&&a.addView((new o.picker.DocsUploadView).setIncludeFolders(!0)),(i=a.build()).setVisible(!0);for(var s=document.getElementsByClassName("picker-dialog"),u=0;u<s.length;++u)s[u].style.zIndex="5000"}))}))}({selectFolderEnabled:!1,showUploadView:!0})})).then((function(e){return e?{fileIdentifier:e.id}:null}))},onSaveProject:function(e,n){var t=n.fileIdentifier,o=(0,r.Z)((0,r.Z)({},n),{},{lastModifiedDate:Date.now()}),i=(0,Gn.h_)(e);return Qn().then((function(e){return function(e,n,t){return fetch("https://www.googleapis.com/upload/drive/v3/files/".concat(e),{method:"PATCH",headers:new Headers({Authorization:"Bearer ".concat(n.getAuthResponse().access_token),"Content-Type":"application/json"}),body:t}).then((function(e){if(200!==e.status)throw 401===e.status&&(Xn=!1),e}))}(t,e,i)})).then((function(){return{wasSaved:!0,fileMetadata:o}}))},getOpenErrorMessage:function(e){return Kn?{id:"Check that you don't have any blocked popup (if so, allow them and retry) and that you have the authorization for reading the file you're trying to access."}:{id:"Google Drive could not be loaded. Check that you are not offline and have a proper internet connection, then try again."}}}}},$n=t(17361),et=t(78081),nt=t(51063),tt=t(85919),rt=t(79431),ot=t.g.gd,it="game.json",at=m().posix||m(),st=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t,r,o,i,a,s,u,l;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.project,r=n.onAddBlobFile,o=n.onProgress,i={erroredResources:[]},a=function(e){var n=e.getResourcesManager();return n.getAllResourceNames().toJSArray().map((function(e){var t,r=n.getResource(e),o=r.getFile();return(t=o).startsWith("http://")||t.startsWith("https://")||t.startsWith("ftp://")||t.startsWith("blob:")||t.startsWith("data:")?(0,tt.yk)(o)?{resource:r,url:o,filename:(0,Pe.dh)(o)}:null:(i.erroredResources.push({resourceName:r.getName(),error:new Error("Unsupported relative file when downloading a copy.")}),null)})).filter(Boolean)},s=a(t),e.next=6,(0,O.R7)({urlContainers:s,onProgress:function(e,n){o(e,2*n)}});case 6:return u=e.sent,l=new Set([it]),u.forEach((function(e){var n=e.item,t=e.error,o=e.blob,a=n.resource,s=n.filename;if(!t&&o){var u=at.extname(s),c=at.basename(s,u),d="assets/"+a.getKind(),p=(0,rt.Z)(c,(function(e){return l.has(at.join(d,e+u))})),f=at.join(d,p+u);l.add(f),a.setFile(f),r({blob:o,filePath:f})}else i.erroredResources.push({resourceName:a.getName(),error:t||new Error("Unknown error during download.")})})),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();function ut(e){var n=e.project,t=e.onDone,i=o.useState(null),s=(0,d.Z)(i,2),u=s[0],f=s[1],h=(0,nt.s)({onDoProcess:o.useCallback((function(e,n){return st((0,r.Z)((0,r.Z)({},e),{},{onProgress:n}))}),[])}),g=h.ensureProcessIsDone,m=h.renderProcessDialog;return o.useEffect((function(){return(0,l.Z)((0,c.Z)().mark((function e(){var t,r,o,i,a;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(null),t=ot.ProjectHelper.createNewGDJSProject(),e.prev=2,r=new ot.SerializerElement,n.serializeTo(r),t.unserializeFrom(r),r.delete(),o=[],i=[],e.next=11,g({project:t,onAddBlobFile:function(e){o.push(e)}});case 11:return i.push({text:JSON.stringify((0,Gn.XH)(t)),filePath:it}),e.next=14,(0,Le.f)({textFiles:i,blobFiles:o,basePath:"/",onProgress:function(e,n){}});case 14:a=e.sent,f(a),e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(2),(0,U.gR)({message:"Unable to save your project because of an internal error.",rawError:e.t0,errorId:"download-file-save-as-dialog-error"}),e.abrupt("return");case 22:return e.prev=22,t.delete(),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[2,18,22,25]])})))(),function(){return f(null)}}),[n,g]),(0,N.jsxs)(P.Z,{title:(0,N.jsx)(p.Trans,{id:"Download a copy"}),actions:[(0,N.jsx)(ee.Z,{label:(0,N.jsx)(p.Trans,{id:"Download GDevelop desktop version"}),primary:!1,onClick:function(){return a.ZP.openExternalURL("http://gdevelop.io")}},"download"),(0,N.jsx)(ee.Z,{label:(0,N.jsx)(p.Trans,{id:"Close"}),primary:!1,onClick:t},"close")],onRequestClose:t,open:!0,maxWidth:"sm",children:[(0,N.jsxs)(v.ak,{noMargin:!0,children:[(0,N.jsx)(ne.Z,{children:(0,N.jsx)(p.Trans,{id:"You can download the file of your game to continue working on it using the full GDevelop version:"})}),(0,N.jsx)(x.x1,{noMargin:!0,expand:!0,justifyContent:"center",children:u?(0,N.jsx)(rn.j,{blob:u,children:function(e){return(0,N.jsx)(w.Z,{primary:!0,onClick:function(){return(0,rn.z)(e,"gdevelop-game.zip")},label:(0,N.jsx)(p.Trans,{id:"Download the compressed game and resources"})})}}):(0,N.jsx)(et.Z,{})})]}),m()]})}var ct,lt,dt={internalName:"DownloadFile",name:{id:"Download a copy"},renderIcon:function(e){return(0,N.jsx)($n.Z,{fontSize:e.size})},hiddenInOpenDialog:!0,createOperations:function(e){var n=e.setDialog,t=e.closeDialog;return{onSaveProjectAs:function(){var e=(0,l.Z)((0,c.Z)().mark((function e(r,o,i){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.onStartSaving(),e.abrupt("return",new Promise((function(e){n((function(){return(0,N.jsx)(ut,{onDone:function(){t(),e({wasSaved:!1,fileMetadata:null})},project:r})}))})));case 2:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}()}}},pt=t(71799),ft=t(10822),ht=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{erroredResources:[]});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),gt=(ct={},(0,I.Z)(ct,"".concat(pt.Z.internalName,"=>").concat(pt.Z.internalName),ft.G),(0,I.Z)(ct,"".concat(Ln.Z.internalName,"=>").concat(pt.Z.internalName),ft.G),(0,I.Z)(ct,"".concat(qn.internalName,"=>").concat(pt.Z.internalName),ht),(0,I.Z)(ct,"".concat(pt.Z.internalName,"=>").concat(qn.internalName),ft.J),(0,I.Z)(ct,"".concat(Ln.Z.internalName,"=>").concat(qn.internalName),ht),(0,I.Z)(ct,"".concat(qn.internalName,"=>").concat(qn.internalName),ht),(0,I.Z)(ct,"".concat(pt.Z.internalName,"=>").concat(dt.internalName),ht),(0,I.Z)(ct,"".concat(Ln.Z.internalName,"=>").concat(dt.internalName),ht),(0,I.Z)(ct,"".concat(qn.internalName,"=>").concat(dt.internalName),ht),ct),mt={moveAllProjectResources:function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t,r,o;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.oldStorageProvider,r=n.newStorageProvider,o=gt["".concat(t.internalName,"=>").concat(r.internalName)]){e.next=4;break}throw new Error("Can't find a ResourceMover for ".concat(t.internalName," to ").concat(r.internalName,"."));case 4:return e.abrupt("return",o(n));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()},xt=mt,vt=t(527),wt=t(58271),bt=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{erroredResources:[]});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),jt=(lt={},(0,I.Z)(lt,pt.Z.internalName,vt.f),(0,I.Z)(lt,qn.internalName,bt),(0,I.Z)(lt,Ln.Z.internalName,wt.j),lt),yt={fetchAllProjectResources:function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.storageProvider,r=jt[t.internalName]){e.next=4;break}throw new Error("Can't find a ResourceFetcher for ".concat(t.internalName," - have you registered the storage provider here?"));case 4:return e.abrupt("return",r(n));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()},Ft=yt,kt=(0,Q.Z)((function e(){(0,X.Z)(this,e)}));kt.chooseEventsFunctionExtensionFile=function(){return new Promise((function(e){if(window.showOpenFilePicker)window.showOpenFilePicker({types:[{description:"GDevelop Extension",accept:{"application/json":[".json"]}}],excludeAcceptAllOption:!0,multiple:!1}).then((function(n){var t=(0,d.Z)(n,1)[0];if(!t)return e(null);e(t.getFile())})).catch((function(){e(null)}));else{var n=document.createElement("input");n.type="file",n.multiple=!1,n.accept="application/json,.json",n.onchange=function(n){var t=n.target.files[0];return e(t)};var t=function t(){document.body&&document.body.removeEventListener("pointermove",t),n.files.length||e(null)};window.addEventListener("focus",(function e(){window.removeEventListener("focus",e),document.body&&document.body.addEventListener("pointermove",t)})),n.click()}}))},kt.readEventsFunctionExtensionFile=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n instanceof File){e.next=3;break}throw console.error("Given file is not a JS File object. Instead it is:",{file:n}),new Error("Given file is not a JS File object.");case 3:return e.prev=3,e.next=6,n.text();case 6:return t=e.sent,e.abrupt("return",JSON.parse(t));case 10:throw e.prev=10,e.t0=e.catch(3),console.error("An error occurred when parsing the file content: ",{error:e.t0}),e.t0;case 14:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(n){return e.apply(this,arguments)}}();var St=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n,t){var r,o,i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(r),(i=document.createElement("a")).href=o,i.download=n,!document.body){e.next=11;break}document.body.appendChild(i),i.click(),i.remove(),e.next=12;break;case 11:throw new Error("Document body couldn't be found.");case 12:return e.abrupt("return");case 13:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),Et=(0,Q.Z)((function e(){(0,X.Z)(this,e)}));Et.chooseEventsFunctionExtensionFile=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Et.writeEventsFunctionsExtension=function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n,t){var r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,Gn.XH)(n,"serializeToExternal"),e.prev=1,e.next=4,St(t,JSON.stringify(r,null,2));case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),console.error("Unable to write the events function extension:",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(n,t){return e.apply(this,arguments)}}();var Pt=t(71445),Zt=t(1333),Nt=a.ZP.isDev(),Rt=function(){function e(n){(0,X.Z)(this,e),this.auth=n}return(0,Q.Z)(e,[{key:"loginWithEmailAndPassword",value:function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.email,r=n.password,e.prev=1,e.next=4,(0,Pt.e5)(this.auth,t,r);case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),console.error("Error while login:",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(n){return e.apply(this,arguments)}}()},{key:"loginOrSignupWithProvider",value:function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var t,r,o,i=this;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.provider,!(r=n.signal)||!r.aborted){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("Login or Signup with provider already aborted.")));case 3:return o=new Promise((function(e,n){r&&r.addEventListener("abort",(function(){(0,Zt.g)(),n(new Error("Login or Signup with provider aborted."))}));var o=window.screenX+window.innerWidth/2-200,a=window.screenY+window.innerHeight/2-300,s=window.open("about:blank",null,"width=".concat(400,",height=").concat(600,",left=").concat(o,",top=").concat(a));s.document.write("<style>body { margin: 0; }</style><div style=\"height: 100vh; display: flex; justify-content: center; align-items: center; color: #F5F5F7; background-color: #25252E; font-family: 'Verdana', 'Fira Sans', 'Open Sans', 'Lucida Sans'; font-size: 20px\">Loading</div>"),(0,Zt.T)({onConnectionEstablished:function(e){if(!r||!r.aborted){var n=new URL("https://auth.gdevelop.io");if(n.searchParams.set("connection-id",e),n.searchParams.set("provider",t),n.searchParams.set("env",Nt?"dev":"live"),!s)throw new Error("Popup could not be found.");s.location=n.toString()}},onTokenReceived:function(){var t=(0,l.Z)((0,c.Z)().mark((function t(o){var a,u,l;return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=o.provider,u=o.data,!r||!r.aborted){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,l="google"===a?Pt.hJ.credential(u.credential):"github"===a?Pt.GH.credential(u.accessToken):new Pt.O4("apple.com").credential({idToken:u.id_token,nonce:u.raw_nonce}),t.next=7,(0,Pt.sB)(i.auth,l);case 7:s&&s.close(),e(),(0,Zt.g)(),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(3),console.error("An error occurred while logging in with ".concat(a," token:"),t.t0),n(t.t0);case 16:case"end":return t.stop()}}),t,null,[[3,12]])})));return function(e){return t.apply(this,arguments)}}(),onError:function(e){r&&r.aborted||((0,Zt.g)(),console.error("An error occurred while setting up authentication web socket:",e),n(new Error("An error occurred while setting up authentication web socket.")))},onTimeout:function(){r&&r.aborted||((0,Zt.g)(),console.error("Connection to authorization websocket timed out."),n(new Error("Connection to authorization websocket timed out.")))}})})),e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}]),e}(),Ct=Rt,Dt=function(e){a.ZP.setUpContextMenu();var n=new Ct(e.auth);e.setLoginProvider(n);var t=a.ZP.getArguments();return(0,N.jsx)(On.Z,{authentication:e,disableCheckForUpdates:!!t["disable-update-check"],makeEventsFunctionCodeWriter:Mn,eventsFunctionsExtensionWriter:Et,eventsFunctionsExtensionOpener:kt,children:function(e){var n=e.i18n;return(0,N.jsx)(Un.Z,{appArguments:t,storageProviders:[Ln.Z,pt.Z,qn,dt],defaultStorageProvider:Ln.Z,children:function(e){var o=e.getStorageProviderOperations,u=e.getStorageProviderResourceOperations,c=e.storageProviders,l=e.initialFileMetadataToOpen,d=e.getStorageProvider;return(0,N.jsx)(i.Z,{i18n:n,renderPreviewLauncher:function(e,n){return(0,N.jsx)(De,(0,r.Z)((0,r.Z)({},e),{},{ref:n}))},renderShareDialog:function(e){return(0,N.jsx)(s.Z,{project:e.project,onSaveProject:e.onSaveProject,isSavingProject:e.isSavingProject,onChangeSubscription:e.onChangeSubscription,onClose:e.onClose,automatedExporters:yn,manualExporters:Fn,onlineWebExporter:jn,allExportersRequireOnline:!0,fileMetadata:e.fileMetadata,storageProvider:e.storageProvider,initialTab:e.initialTab,gamesList:e.gamesList})},quickPublishOnlineWebExporter:jn,storageProviders:c,resourceMover:xt,resourceFetcher:Ft,getStorageProviderOperations:o,getStorageProviderResourceOperations:u,getStorageProvider:d,resourceSources:D,resourceExternalEditors:V,extensionsLoader:Nn({objectsEditorService:Sn.Z,objectsRenderingService:En.Z,filterExamples:!a.ZP.isDev()}),initialFileMetadataToOpen:l,initialExampleSlugToOpen:t["create-from-example"]||null})}})}})}}}]);
//# sourceMappingURL=browser-app.ea37f889.chunk.js.map